<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Precio Medio Ponderado</title>
  <style>
    :root{
      --bg:#0b1224;
      --card:#0f172a;
      --card2:#0b132a;
      --accent:#38bdf8;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:rgba(148,163,184,.22);
      --shadow:0 18px 45px rgba(0,0,0,.45);
      --r-lg:18px;
      --r-xl:24px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    body{
      margin:0;
      padding:18px 14px;
      min-height:100vh;
      color:var(--text);
      background:radial-gradient(circle at top, #1f2937 0, #020617 45%, #000 100%);
      display:flex;
      justify-content:center;
    }
    .app{
      width:100%;
      max-width:720px;
      background:linear-gradient(135deg, rgba(15,23,42,.96), rgba(2,6,23,.98));
      border:1px solid rgba(148,163,184,.2);
      border-radius:28px;
      box-shadow:var(--shadow);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .app::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,.14), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56,189,248,.16), transparent 60%);
      opacity:.55;
      pointer-events:none;
      z-index:-1;
    }
    header{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
      margin-bottom:14px;
    }
    h1{
      font-size:18px;
      margin:0 0 4px 0;
      display:flex;
      gap:8px;
      align-items:center;
      line-height:1.2;
    }
    .logo{
      width:26px;height:26px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      background:radial-gradient(circle at 30% 30%, #e0f2fe, #38bdf8);
      color:#020617;font-weight:800;
      box-shadow:0 0 0 2px rgba(56,189,248,.25);
    }
    header p{margin:0;color:var(--muted);font-size:12px}
    .tag{
      display:inline-flex;align-items:center;gap:6px;
      font-size:11px;color:var(--muted);
      padding:6px 10px;border-radius:999px;
      background:rgba(2,6,23,.55);
      border:1px solid rgba(148,163,184,.28);
      white-space:nowrap;
      margin-top:2px;
    }
    .dot{width:7px;height:7px;border-radius:999px;background:var(--accent);box-shadow:0 0 0 4px rgba(56,189,248,.25)}
    .card{
      background:radial-gradient(circle at top left, rgba(15,23,42,.95), rgba(2,6,23,.95));
      border:1px solid var(--border);
      border-radius:var(--r-xl);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .card + .card{margin-top:12px}
    .card h2{
      margin:0 0 10px 0;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:#dbeafe;
      opacity:.9;
    }
    .inputs{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width:520px){
      .inputs{grid-template-columns:1fr}
      header{flex-direction:column}
      .tag{align-self:flex-start}
    }
    .field{display:flex;flex-direction:column;gap:5px}
    .field label{
      display:flex;justify-content:space-between;gap:8px;
      font-size:11px;text-transform:uppercase;letter-spacing:.06em;
      color:var(--muted);
    }
    .field input[type="number"]{
      width:100%;
      padding:9px 10px;
      border-radius:14px;
      border:1px solid rgba(55,65,81,.95);
      background:rgba(2,6,23,.55);
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    .field input[type="number"]:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(56,189,248,.65);
      background:rgba(2,6,23,.72);
    }
    .hint{
      margin-top:10px;
      font-size:11px;
      color:var(--muted);
      line-height:1.35;
    }
    .stats{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (max-width:520px){
      .stats{grid-template-columns:1fr}
    }
    .stat{
      background:rgba(2,6,23,.55);
      border:1px solid rgba(148,163,184,.2);
      border-radius:16px;
      padding:10px 10px;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .stat .k{
      font-size:10px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .stat .v{
      font-weight:700;
      font-size:15px;
      line-height:1.1;
    }
    .delta{
      font-size:11px;
      color:var(--muted);
    }
    .delta.good{color:#4ade80}
    .delta.bad{color:#f97373}
    .slider-card{
      background:rgba(2,6,23,.45);
      border:1px solid rgba(148,163,184,.18);
      border-radius:18px;
      padding:10px 10px 12px;
      position:relative;
    }
    .slider-card + .slider-card{margin-top:10px}
    .slider-head{
      display:flex;justify-content:space-between;align-items:center;
      gap:10px;margin-bottom:8px;
    }
    .slider-title{
      display:flex;flex-direction:column;gap:2px;
    }
    .slider-title .a{
      font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)
    }
    .slider-title .b{
      font-size:12px;font-weight:700;color:#e5e7eb
    }
    .lock{
      display:inline-flex;align-items:center;gap:6px;
      font-size:10px;color:var(--muted);
      padding:3px 8px;border-radius:999px;
      border:1px solid rgba(55,65,81,.85);
      background:rgba(2,6,23,.5);
      user-select:none;
    }
    .lock input{accent-color:var(--accent)}
    .slider-body{
      display:grid;
      grid-template-columns:1fr 110px;
      gap:10px;
      align-items:center;
    }
    @media (max-width:520px){
      .slider-body{grid-template-columns:1fr 120px}
    }
    input[type="range"]{
      width:100%;
      -webkit-appearance:none;
      appearance:none;
      background:transparent;
    }
    input[type="range"]::-webkit-slider-runnable-track{
      height:6px;border-radius:999px;
      background:linear-gradient(90deg, rgba(56,189,248,.18), rgba(56,189,248,.7));
    }
    input[type="range"]::-moz-range-track{
      height:6px;border-radius:999px;
      background:linear-gradient(90deg, rgba(56,189,248,.18), rgba(56,189,248,.7));
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;
      width:14px;height:14px;border-radius:50%;
      background:#e5e7eb;border:2px solid #020617;
      box-shadow:0 0 0 3px rgba(2,6,23,.9), 0 0 0 5px rgba(56,189,248,.65);
      margin-top:-4px;
    }
    input[type="range"]::-moz-range-thumb{
      width:14px;height:14px;border-radius:50%;
      background:#e5e7eb;border:2px solid #020617;
      box-shadow:0 0 0 3px rgba(2,6,23,.9), 0 0 0 5px rgba(56,189,248,.65);
    }
    .minmax{
      display:flex;justify-content:space-between;
      font-size:10px;color:var(--muted);
      margin-top:6px;
    }
    .num{
      width:100%;
      padding:7px 8px;
      border-radius:12px;
      border:1px solid rgba(55,65,81,.95);
      background:rgba(2,6,23,.55);
      color:var(--text);
      font-size:13px;
      text-align:right;
      outline:none;
    }
    .num:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(56,189,248,.6);
    }
    .overlay{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      text-align:center;
      padding:18px;
      font-size:12px;
      color:var(--muted);
      background:radial-gradient(circle at top, rgba(15,23,42,.75), rgba(2,6,23,.94));
      backdrop-filter: blur(2px);
      z-index:5;
    }
    code{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-size:11px;
      color:#cbd5e1;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1><span class="logo">μ</span> Precio medio ponderado</h1>
        <p>Introduce tu posición base y juega con ΔQ, P y el nuevo Avg Cost bloqueando lo que quieras.</p>
      </div>
      <div class="tag"><span class="dot"></span> Sliders vinculados · límites fijos</div>
    </header>

    <!-- Inputs arriba -->
    <section class="card">
      <h2>Posición base</h2>
      <div class="inputs">
        <div class="field">
          <label>Quantity <span id="baseQtyHint"></span></label>
          <input id="baseQty" type="number" min="0" step="1" placeholder="p.ej. 5000" />
        </div>
        <div class="field">
          <label>Average Cost <span id="avgCostHint"></span></label>
          <input id="avgCost" type="number" min="0" step="0.01" placeholder="p.ej. 93570" />
        </div>
      </div>

      <div class="hint">
        Fórmula: <code>(Q₀×AC₀ + ΔQ×P) / (Q₀ + ΔQ)</code>
        <br/>
        Los <strong>límites</strong> se calculan una vez al introducir Q₀ y AC₀, y no se vuelven a tocar salvo que cambies estos inputs.
      </div>

      <div class="stats">
        <div class="stat">
          <div class="k">Cantidad total futura</div>
          <div class="v" id="totalQty">–</div>
          <div class="delta">Q₀ + ΔQ</div>
        </div>
        <div class="stat">
          <div class="k">Coste medio futuro</div>
          <div class="v" id="futureAvgCost">–</div>
          <div class="delta" id="avgDeltaLabel">Mueve los sliders…</div>
        </div>
      </div>
    </section>

    <!-- Sliders abajo -->
    <section class="card" style="position:relative;">
      <div id="slidersOverlay" class="overlay">
        Introduce primero <strong>Quantity</strong> y <strong>Average Cost</strong> para activar los sliders.
      </div>

      <h2>Escenario</h2>

      <!-- ΔQ -->
      <div class="slider-card">
        <div class="slider-head">
          <div class="slider-title">
            <div class="a">Δ Quantity</div>
            <div class="b">Additional Quantity</div>
          </div>
          <label class="lock"><input id="lockQty" type="checkbox" /> Fijar</label>
        </div>

        <div class="slider-body">
          <div>
            <input id="sliderQty" type="range" min="0" max="0" step="1" value="0" />
            <div class="minmax">
              <span id="sliderQtyMinLabel">0</span>
              <span id="sliderQtyMaxLabel">0</span>
            </div>
          </div>
          <input id="inputQty" class="num" type="number" min="0" step="1" value="0" />
        </div>
      </div>

      <!-- P -->
      <div class="slider-card">
        <div class="slider-head">
          <div class="slider-title">
            <div class="a">P actual</div>
            <div class="b">Current Price</div>
          </div>
          <label class="lock"><input id="lockPrice" type="checkbox" /> Fijar</label>
        </div>

        <div class="slider-body">
          <div>
            <input id="sliderPrice" type="range" min="0" max="0" step="0.01" value="0" />
            <div class="minmax">
              <span id="sliderPriceMinLabel">0</span>
              <span id="sliderPriceMaxLabel">0</span>
            </div>
          </div>
          <input id="inputPrice" class="num" type="number" min="0" step="0.01" value="0" />
        </div>
      </div>

      <!-- New Avg -->
      <div class="slider-card">
        <div class="slider-head">
          <div class="slider-title">
            <div class="a">AC futuro</div>
            <div class="b">New Average Cost</div>
          </div>
          <label class="lock"><input id="lockAvg" type="checkbox" /> Fijar</label>
        </div>

        <div class="slider-body">
          <div>
            <input id="sliderAvg" type="range" min="0" max="0" step="0.01" value="0" />
            <div class="minmax">
              <span id="sliderAvgMinLabel">0</span>
              <span id="sliderAvgMaxLabel">0</span>
            </div>
          </div>
          <input id="inputAvg" class="num" type="number" min="0" step="0.01" value="0" />
        </div>
      </div>
    </section>
  </div>

  <script>
    const state = {
      baseQty: 0,
      avgCost: 0,

      additionalQty: 0,
      currentPrice: 0,
      newAvgCost: 0,

      locks: { qty: false, price: false, avg: false },

      // ranges “congelados” (solo cambian al editar inputs base)
      ranges: {
        qty:  { min: 0, max: 0 },
        price:{ min: 0, max: 0 },
        avg:  { min: 0, max: 0 },
      },

      initialized: false,
    };

    const QTY_FACTOR = 5;

    function toNumber(v){ const n = parseFloat(v); return isNaN(n) ? 0 : n; }
    function clamp(v,min,max){ return Math.min(max, Math.max(min, v)); }

    function formatNumber(value, decimals = 2) {
      if (!isFinite(value)) return "–";
      return value.toLocaleString("es-ES", {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals,
      });
    }

    function computeAvgCost(Q0, AC0, dq, P) {
      if (Q0 + dq <= 0) return AC0;
      return (Q0 * AC0 + dq * P) / (Q0 + dq);
    }

    // dq = Q0*(AC0 - targetAvg)/(targetAvg - P)
    function solveDQ(Q0, AC0, P, targetAvg) {
      const denom = (targetAvg - P);
      if (Math.abs(denom) < 1e-12) return null;
      return Q0 * (AC0 - targetAvg) / denom;
    }

    // P = (targetAvg*(Q0+dq) - Q0*AC0)/dq
    function solveP(Q0, AC0, dq, targetAvg) {
      if (Math.abs(dq) < 1e-12) return null;
      return (targetAvg * (Q0 + dq) - (Q0 * AC0)) / dq;
    }

    // DOM
    const baseQtyInput = document.getElementById("baseQty");
    const avgCostInput = document.getElementById("avgCost");
    const baseQtyHint = document.getElementById("baseQtyHint");
    const avgCostHint = document.getElementById("avgCostHint");

    const totalQtyEl = document.getElementById("totalQty");
    const futureAvgCostEl = document.getElementById("futureAvgCost");
    const avgDeltaLabel = document.getElementById("avgDeltaLabel");
    const overlay = document.getElementById("slidersOverlay");

    const sliderQty = document.getElementById("sliderQty");
    const inputQty  = document.getElementById("inputQty");
    const qtyMinLbl = document.getElementById("sliderQtyMinLabel");
    const qtyMaxLbl = document.getElementById("sliderQtyMaxLabel");

    const sliderPrice = document.getElementById("sliderPrice");
    const inputPrice  = document.getElementById("inputPrice");
    const priceMinLbl = document.getElementById("sliderPriceMinLabel");
    const priceMaxLbl = document.getElementById("sliderPriceMaxLabel");

    const sliderAvg = document.getElementById("sliderAvg");
    const inputAvg  = document.getElementById("inputAvg");
    const avgMinLbl = document.getElementById("sliderAvgMinLabel");
    const avgMaxLbl = document.getElementById("sliderAvgMaxLabel");

    const lockQty = document.getElementById("lockQty");
    const lockPrice = document.getElementById("lockPrice");
    const lockAvg = document.getElementById("lockAvg");

    function baseIsValid(){
      return state.baseQty > 0 && state.avgCost > 0;
    }

    function setOverlayEnabled(enabled){
      overlay.style.display = enabled ? "none" : "flex";
    }

    // Calcula rango posible de Avg usando extremos (dq max y P min/max) + dq=0 => AC0
    function computeFrozenAvgRange(Q0, AC0, dqMax, Pmin, Pmax){
      const candidates = [AC0];
      if (dqMax > 0) {
        candidates.push(computeAvgCost(Q0, AC0, dqMax, Pmin));
        candidates.push(computeAvgCost(Q0, AC0, dqMax, Pmax));
      }
      let mn = Math.min(...candidates);
      let mx = Math.max(...candidates);
      if (mn === mx) { mn = AC0 * 0.9; mx = AC0 * 1.1; }
      return { min: Math.max(0, mn), max: mx };
    }

    // SOLO se llama al cambiar inputs base (Q0 / AC0)
    function freezeAllRangesFromBase(){
      const Q0 = state.baseQty;
      const AC0 = state.avgCost;

      // ΔQ range fijo
      state.ranges.qty.min = 0;
      state.ranges.qty.max = Q0 * QTY_FACTOR;

      // Precio range fijo en base a AC0 (no a slider)
      state.ranges.price.min = Math.max(0, AC0 * 0.5);
      state.ranges.price.max = AC0 * 1.5;

      // Avg range fijo
      const avgRange = computeFrozenAvgRange(
        Q0, AC0,
        state.ranges.qty.max,
        state.ranges.price.min,
        state.ranges.price.max
      );
      state.ranges.avg.min = avgRange.min;
      state.ranges.avg.max = avgRange.max;

      // Aplicar a inputs range (NO volver a tocar salvo base)
      sliderQty.min = state.ranges.qty.min;
      sliderQty.max = state.ranges.qty.max;
      qtyMinLbl.textContent = formatNumber(state.ranges.qty.min, 0);
      qtyMaxLbl.textContent = formatNumber(state.ranges.qty.max, 0);

      sliderPrice.min = state.ranges.price.min;
      sliderPrice.max = state.ranges.price.max;
      priceMinLbl.textContent = formatNumber(state.ranges.price.min, 2);
      priceMaxLbl.textContent = formatNumber(state.ranges.price.max, 2);

      sliderAvg.min = state.ranges.avg.min;
      sliderAvg.max = state.ranges.avg.max;
      avgMinLbl.textContent = formatNumber(state.ranges.avg.min, 2);
      avgMaxLbl.textContent = formatNumber(state.ranges.avg.max, 2);
    }

    function updateStats(){
      const Q0 = state.baseQty;
      const AC0 = state.avgCost;
      const dq = state.additionalQty;
      const totalQ = Q0 + dq;

      totalQtyEl.textContent = baseIsValid() ? formatNumber(totalQ, 0) : "–";

      const newAC = computeAvgCost(Q0, AC0, dq, state.currentPrice);
      futureAvgCostEl.textContent = baseIsValid() ? formatNumber(newAC, 2) : "–";

      const delta = newAC - AC0;
      if (!baseIsValid()) {
        avgDeltaLabel.textContent = "Mueve los sliders…";
        avgDeltaLabel.className = "delta";
        return;
      }
      if (Math.abs(delta) < 1e-6) {
        avgDeltaLabel.textContent = "Sin cambio en el coste medio";
        avgDeltaLabel.className = "delta";
      } else if (delta < 0) {
        avgDeltaLabel.textContent = "Mejora en " + formatNumber(-delta, 2);
        avgDeltaLabel.className = "delta good";
      } else {
        avgDeltaLabel.textContent = "Empeora en " + formatNumber(delta, 2);
        avgDeltaLabel.className = "delta bad";
      }
    }

    function syncUI(){
      // clamp SIEMPRE a rangos congelados
      state.additionalQty = clamp(state.additionalQty, state.ranges.qty.min, state.ranges.qty.max);
      state.currentPrice  = clamp(state.currentPrice,  state.ranges.price.min, state.ranges.price.max);
      state.newAvgCost    = clamp(state.newAvgCost,    state.ranges.avg.min, state.ranges.avg.max);

      sliderQty.value = String(state.additionalQty);
      inputQty.value  = String(Math.round(state.additionalQty));

      sliderPrice.value = String(state.currentPrice);
      inputPrice.value  = state.currentPrice.toFixed(2);

      sliderAvg.value = String(state.newAvgCost);
      inputAvg.value  = state.newAvgCost.toFixed(2);

      lockQty.checked = !!state.locks.qty;
      lockPrice.checked = !!state.locks.price;
      lockAvg.checked = !!state.locks.avg;

      updateStats();
    }

    // Motor de relación según “origen”
    function applyFromQty(){
      const Q0 = state.baseQty, AC0 = state.avgCost, dq = state.additionalQty;

      if (!state.locks.avg) {
        state.newAvgCost = computeAvgCost(Q0, AC0, dq, state.currentPrice);
        return;
      }
      // Avg fijo => ajustar P si posible y no lock
      if (!state.locks.price) {
        const P = solveP(Q0, AC0, dq, state.newAvgCost);
        if (P != null && isFinite(P)) state.currentPrice = P;
      }
    }

    function applyFromPrice(){
      const Q0 = state.baseQty, AC0 = state.avgCost;

      if (!state.locks.avg) {
        state.newAvgCost = computeAvgCost(Q0, AC0, state.additionalQty, state.currentPrice);
        return;
      }
      // Avg fijo => ajustar ΔQ si posible y no lock
      if (!state.locks.qty) {
        const dq = solveDQ(Q0, AC0, state.currentPrice, state.newAvgCost);
        if (dq != null && isFinite(dq)) state.additionalQty = dq;
      }
    }

    function applyFromAvg(){
      const Q0 = state.baseQty, AC0 = state.avgCost, target = state.newAvgCost;

      // Preferencia: ajustar ΔQ si libre, si no P
      if (!state.locks.qty) {
        const dq = solveDQ(Q0, AC0, state.currentPrice, target);
        if (dq != null && isFinite(dq)) {
          state.additionalQty = dq;
          return;
        }
      }
      if (!state.locks.price) {
        const P = solveP(Q0, AC0, state.additionalQty, target);
        if (P != null && isFinite(P)) {
          state.currentPrice = P;
          return;
        }
      }
    }

    function initIfPossible(){
      if (!baseIsValid()) {
        state.initialized = false;
        setOverlayEnabled(false);
        syncUI();
        return;
      }

      state.initialized = true;
      setOverlayEnabled(true);

      // Congelar rangos en base a inputs base
      freezeAllRangesFromBase();

      // Defaults (coherentes)
      state.additionalQty = 0;
      state.currentPrice = state.avgCost;
      state.newAvgCost = state.avgCost;

      syncUI();
    }

    // Events base
    function onBaseChange(){
      state.baseQty = Math.max(0, Math.floor(toNumber(baseQtyInput.value)));
      state.avgCost = Math.max(0, toNumber(avgCostInput.value));

      baseQtyHint.textContent = state.baseQty ? formatNumber(state.baseQty, 0) : "";
      avgCostHint.textContent = state.avgCost ? formatNumber(state.avgCost, 2) : "";

      initIfPossible();
    }

    // Slider events (NO recalcular rangos)
    function onQtyChange(v){
      if (!state.initialized) return;
      state.additionalQty = toNumber(v);
      applyFromQty();
      syncUI();
    }
    function onPriceChange(v){
      if (!state.initialized) return;
      state.currentPrice = toNumber(v);
      applyFromPrice();
      syncUI();
    }
    function onAvgChange(v){
      if (!state.initialized) return;
      state.newAvgCost = toNumber(v);
      applyFromAvg();
      syncUI();
    }

    function onLockToggle(){
      state.locks.qty = lockQty.checked;
      state.locks.price = lockPrice.checked;
      state.locks.avg = lockAvg.checked;

      // si lockeas Avg, proyecta coherencia
      if (state.initialized && state.locks.avg) applyFromAvg();
      syncUI();
    }

    // Wire
    baseQtyInput.addEventListener("input", onBaseChange);
    avgCostInput.addEventListener("input", onBaseChange);

    sliderQty.addEventListener("input", (e)=>onQtyChange(e.target.value));
    sliderPrice.addEventListener("input", (e)=>onPriceChange(e.target.value));
    sliderAvg.addEventListener("input", (e)=>onAvgChange(e.target.value));

    inputQty.addEventListener("input", (e)=>{
      if (!state.initialized) return;
      const v = Math.max(0, Math.floor(toNumber(e.target.value)));
      state.additionalQty = clamp(v, state.ranges.qty.min, state.ranges.qty.max);
      applyFromQty();
      syncUI();
    });

    inputPrice.addEventListener("input", (e)=>{
      if (!state.initialized) return;
      const v = Math.max(0, toNumber(e.target.value));
      state.currentPrice = clamp(v, state.ranges.price.min, state.ranges.price.max);
      applyFromPrice();
      syncUI();
    });

    inputAvg.addEventListener("input", (e)=>{
      if (!state.initialized) return;
      const v = Math.max(0, toNumber(e.target.value));
      state.newAvgCost = clamp(v, state.ranges.avg.min, state.ranges.avg.max);
      applyFromAvg();
      syncUI();
    });

    lockQty.addEventListener("change", onLockToggle);
    lockPrice.addEventListener("change", onLockToggle);
    lockAvg.addEventListener("change", onLockToggle);

    // Init UI
    setOverlayEnabled(false);
    syncUI();
  </script>
</body>
</html>
